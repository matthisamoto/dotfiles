#!/usr/bin/env bash

NAME="virb"
SOCKET_NAME="tmux-socket"
SOCKET_PATH="/tmp/$SOCKET_NAME"

if ! $(tmux -S $SOCKET_PATH has-session -t $NAME &> /dev/null); then
    VIRB_DIR=$HOME/Dev/Work/virb
    BASE_DIR=$HOME/Dev/Work/base
    VIRBOT_DIR=$HOME/Dev/src/github.com/virb/virbot
    UTILS_DIR=$HOME/Dev/Work/utils/fabric
    DOTFILES_DIR=$HOME/.dotfiles

    # Virb code
    cd $VIRB_DIR
    tmux -S $SOCKET_PATH start-server
    tmux -S $SOCKET_PATH new-session -d -s $NAME -n virb

    # Base code
    tmux -S $SOCKET_PATH set-option -t $NAME default-path $BASE_DIR
    tmux -S $SOCKET_PATH new-window -t $NAME:2 -n base

    # Virtual Machine
    tmux -S $SOCKET_PATH set-option -t $NAME default-path $VIRB_DIR
    tmux -S $SOCKET_PATH new-window -t $NAME:3 -n vm
    tmux -S $SOCKET_PATH send-keys -t $NAME:3 "vagrant up && ssh virbvm" C-m

    # Virbot
    tmux -S $SOCKET_PATH set-option -t $NAME default-path $VIRBOT_DIR
    tmux -S $SOCKET_PATH new-window -t $NAME:4 -n virbot

    # Utils
    tmux -S $SOCKET_PATH set-option -t $NAME default-path $UTILS_DIR
    tmux -S $SOCKET_PATH new-window -t $NAME:5 -n utils

    # Dotfiles
    tmux -S $SOCKET_PATH set-option -t $NAME default-path $DOTFILES_DIR
    tmux -S $SOCKET_PATH new-window -t $NAME:6 -n dotfiles

    tmux -S $SOCKET_PATH set-option -t $NAME default-path "$PWD"
    tmux -S $SOCKET_PATH select-window -t $NAME:1
fi

tmux -S $SOCKET_PATH -u attach-session -t $NAME
